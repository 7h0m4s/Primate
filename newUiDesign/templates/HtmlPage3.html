<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
</head>
<body ng-app="myApp" ng-controller="myCtrl">
    <ul data-role="dropdown" style="display: block;">
        {{tree[0].groupName}}
        <li ng-repeat="node in tree.groups"><a>{{node.groupName}}</a></li>
    </ul>
</body>
</html>
<script src="js/jquery.min.js"></script>
<script src="js/angular.min.js"></script>
<script src="js/jquery.widget.min.js"></script>
<script src="js/metro.min.js"></script>
<script src="js/jquery.splitter.js"></script>
<script src="js/jquery.contextMenu.js"></script>
<script src="js/jquery.spinner.min.js"></script>
<script src="js/primate.js"></script>
<script src="js/angular/controllers/mainController.js"></script>
<script>
    var haha = '{"groupName":"Haha","children":[{"uuid":"79873249827346","title":"hello1","user":"username","passwd":"1234","notes":"this is a note","last_mod":0,"url":"google.com"},{"uuid":"68678676867","title":"hello2","user":"username","passwd":"1234","notes":"this is a note","last_mod":0,"url":"google.com"},{"uuid":"123123131","title":"hello3","user":"username","passwd":"1234","notes":"this is a note","last_mod":0,"url":"google.com"}],"groups":[{"groupName":"Sites","children":[{"uuid":"79873249827346","title":"hello4","user":"username","passwd":"1234","notes":"this is a note","last_mod":0,"url":"google.com"},{"uuid":"79873249827346","title":"hello4","user":"username","passwd":"1234","notes":"this is a note","last_mod":0,"url":"google.com"},{"uuid":"79873249827346","title":"hello4.1","user":"username","passwd":"1234","notes":"this is a note","last_mod":0,"url":"google.com"}],"groups":[{"groupName":"siteSub1","children":[{"uuid":"79873249827346","title":"hello5","user":"username","passwd":"1234","notes":"this is a note","last_mod":0,"url":"google.com"}],"groups":[{"groupName":"Sitessub2.1","children":[{"uuid":"79873249827346","title":"hello6","user":"username","passwd":"1234","notes":"this is a note","last_mod":0,"url":"google.com"}],"groups":[]},{"groupName":"subsub2.2","children":[],"groups":[]}]}]},{"groupName":"sub2","children":[],"groups":[]}]}';
    var text = '{ "employees" : [' +
'{ "firstName":"John" , "lastName":"Doe" },' +
'{ "firstName":"Anna" , "lastName":"Smith" },' +
'{ "firstName":"Peter" , "lastName":"Jones" } ]}';
    console.log(haha);
    var aa = $.parseJSON(haha);
    var app = angular.module('myApp', []);

    //app.controller('myCtrl', function (   $scope, myService) {
    //    myService.get().then(function (datas) {
    //        $scope.tree = datas;
    //        //haha = JSON.parse($scope.tree);
    //        //console.log(haha);
    //    });
        
    //    console.log($scope.haha);
    //});

    app.factory('myService', function ($q, $http) {
        var myService = {
            get: function () {
                var deferred = $q.defer();
                var defs = [];
                var promises = [];

                var i = 0;
                var length = 4;

                for (var j = 0; j < length; ++j) {
                    defs[j] = $q.defer();
                    promises[j] = defs[j].promise;
                }

                makeCall(i, length, defs);

                $q.all(promises).then(function (datas) {
                    deferred.resolve(datas);
                });

                return deferred.promise;
            }
        }

        function makeCall(i, length, defs) {
            if (i < length) {
                $http.get('json/tree-data.txt').then(function (resp) {
                    defs[i].resolve(resp.data + i);
                    ++i;
                    makeCall(i, length, defs);
                });
            }
        }
        return myService;
    });
</script>
